# ==============================================================================
# CONFIG NAME: barat.conf
# DESCRIPTION: Nginx VirtualHost untuk Backend Barat (HTTPS Port 4435)
# TASK       : SEVIMA Sysadmin Task - Soal C.1 & C.3
# AUTHOR     : Angga Alfiansah
# ==============================================================================

server {
    # Mendengarkan pada Port 4435 dengan protokol SSL aktif.
    listen 4435 ssl;
    server_name barat.sevima.site;

    # --- REDIRECT HTTP KE HTTPS (Soal C.3.a) ---
    if ($http_x_forwarded_proto = "http") {
        return 301 https://$host:4435$request_uri;
    }

    # --- KONFIGURASI KONTEN ---
    # Menggunakan direktori yang telah disiapkan secara konsisten pada entrypoint.
    root /var/www/html/barat;
    index index.html;

    # --- KONFIGURASI SSL (Soal C.3) ---
    # Sertifikat diterbitkan oleh Internal SEVIMA CA melalui setup_ca.sh.
    ssl_certificate /root/ca/barat.sevima.site.crt;
    ssl_certificate_key /root/ca/barat.sevima.site.key;

    # Protokol SSL yang disarankan untuk keamanan optimal
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # --- PENANGANAN REQUEST ---
    location / {
        # Mencoba melayani file statis, jika tidak ditemukan kembali ke error 404.
        try_files $uri $uri/ =404;
    }

    # Custom Error Logging
    error_log /var/log/nginx/barat_error.log;
    access_log /var/log/nginx/barat_access.log;
}